# Survey App: Single-Page Flow Specification

## Overview
- The app is a single-page React app (SPA) with only one URL endpoint.
- User state is managed in the frontend and backend (via API).

## User Flow

0. **Initial Load**
   - On initial load:
      - Fetch all the answer counts for all questions, to use in feedback.
      - Check local storage for user info.
   - If no user info, show registration page.
   - If user info exists, fetch user's answers and answer counts from the backend and resume the survey.

1. **Registration Page**
   - If no user is present in local storage, show a registration page.
   - User can pick a username, or one is autogenerated (random adjective + noun).
   - On registration, user is created in the backend and user info is stored in local storage.

2. **Survey Pages**
   - For each question in the database, render a SurveyPage component.
   - User selects an answer (e.g., color/option) for each question.
   - Each answer is sent to the backend via the API (add-or-update answer endpoint).
   - Feedback is shown after each answer, based on the results of the answer_counts that were loaded during initial load (or page reload).
   - The app does NOT automatically advance to the next question after a prediction is submitted.
   - When feedback is shown, a "Next Question" button appears at the bottom of the feedback section.
   - The user must click the "Next Question" button to advance to the next question. On the last question, the button says "Finish Survey".
   - **Prediction and Feedback Behavior:**
        - When the page first loads, neither the prediction input nor feedback is shown.
        - After the user selects an answer option (e.g., a fruit), the prediction input appears.
        - The prediction input label updates to mention the selected answer (e.g., "What percentage ... will also choose Banana?").
        - When the user enters a prediction value, the feedback section appears, showing feedback based on their prediction and the actual results.
        - If the user changes their answer (e.g., selects a different fruit), the prediction input is reset (emptied), the label updates to the new answer, and the feedback section disappears.
        - After changing the answer and entering a new prediction, the feedback section reappears.
        - Feedback is only shown after a prediction is entered for the current answer.

3. **Summary Page**
   - After all questions are answered, show a summary page:
     - List all questions and the user's answers
     - Show survey results (answer counts) for all questions

4. **Session Persistence and Page Refresh**
   - If the user has already started a session (user info in local storage)
      - fetch answers and answer counts from the backen
      - resume the survey at the appropriate question.
   - If all questions are answered, show the summary page.

## Navigation
- Provide forward and back buttons to navigate between questions.
   - Only provide forward button if the current question was answered.
   - On the summary page, provide a back button to go to the last question.
   - Only provide a back button after the first question.
- Navigation does NOT change the URL (single-page app).


## API Endpoints Used
- `GET /api/questions` — get all questions and options
- `GET /api/answers?user_id=...` — get all answers for the user
- `POST /api/answers` — add or update an answer
- `GET /api/answer_counts?question_id=...` — get answer counts for a question

## Notes
- All state transitions (registration, answering, summary) are handled in the React app.
- Usernames are unique; if a generated username collides, generate a new one.
- No authentication required for now (username is sufficient for session).


